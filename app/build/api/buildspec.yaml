version: 0.2

env:
  variables:
    TZ: Asia/Tokyo

phases:
  pre_build:
    on-failure: ABORT
    commands:
      - aws s3 cp s3://$ENV/some_file ./app/some_file
  build:
    on-failure: ABORT
    commands:
      - ./app/build/api/docker-build.sh
  post_build:
    on-failure: ABORT
    commands:
      - |
        set -e
        . ./app/build/api/ecr-push.sh
        printf '[{"name":"%s-api","imageUri":"%s"}]' $ENV $ECR/$REPOSITORY:$NOWJST > imagedefinitions.json

artifacts:
  files: imagedefinitions.json
